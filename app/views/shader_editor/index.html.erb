<div id="shadergif-app" class="vertical-scroll-parent columns">
	<div class="column limit-width-desktop">
		<div class="vertical-scroll gif-pane">
			<div class="text-center">
				<h3>Gif preview</h3>
				<div class="player-container">
				</div>
			</div>
			<pre class="fragment-error-pre error-pre">
			</pre>
			<pre class="vertex-error-pre error-pre">
			</pre>
			
			<div class="foldable">
				<div class="foldable-header">
					Draft management
				</div>
				<div class="foldable-content">
					<div class="draft-management">
						<% if user_signed_in? %>
							<% if @is_draft %>
								<%= form_tag("/gifs/save_draft", method: "post") do %>
									<div class="field">
										<label class="label">Draft title</label>
										<div class="control">
											<input type="text" name="title" placeholder="Give this a name" value="<%= @draft.title %>">
										</div>
									</div>
									<input type="hidden"
										   name="code"
										   v-bind:value="code">
									<input type="hidden"
										   name="draft_id"
										   value="<%= @draft.id %>">
									<div class="has-text-right pull-right">
										<%= submit_tag "Save draft", :class => "button is-primary" %>
									</div>
								<% end %>
							<% else %>
								<%= form_tag("/gifs/new_draft", method: "post") do %>
									<div class="field">
										<label class="label">Title</label>
										<div class="control">
											<input type="text" name="title" placeholder="Give this a name">
										</div>
									</div>
									<input type="hidden"
										   name="code"
										   v-bind:value="code">
									<div class="has-text-right pull-right">
										<%= submit_tag "Create a new draft", :class => "button is-primary" %>
									</div>
								<% end %>
							<% end %>
						<% else %>
							<div class="text-center">
								Create an account or login to save drafts
							</div>
						<% end %>
					</div>
				</div>
			</div>
			<div class="foldable">
				<div class="foldable-header">
					Gif tools
				</div>
				<div class="foldable-content">
					<div class="text-center">
						<p>
							<button name="make-gif" v-on:click="make_gif" class="inline-block">
								<template v-if="!rendering_gif">
									Create gif
								</template>
								<template v-else>
									Rendering...
								</template>
							</button>
							<button name="make-png" v-on:click="make_png" class="inline-block">
								Create stacked png
							</button>
							<button name="make-zip"
									v-on:click="make_zip"
									class="inline-block">
								Create .zip file
							</button>
							<a v-if="has_zip"
							   v-bind:href="zip_url"
							   download="images.zip"
							   class="inline-block"
							   v-on:click="delete_downloaded_zip">
								<button>
									Save Zip
								</button>
							</a>
						</p>
						<p>
							<label for="autocompile">
								Automatically recompile while typing
							</label>
							<input id="autocompile" type="checkbox" v-model="autocompile">
						</p>
						<p>
							<button name="recompile"
									v-if="!autocompile"
									v-on:click="recompile">
								Compile and run
							</button>
						</p>
					</div>
					<div class="text-center">
						<div class="settings inline-block">
							<p>
								w:<input type="number" v-model.number="width">
								h:<input type="number" v-model.number="height">
								frames:<input type="number"
											  v-if="!frames_defined_in_code"
											  v-model.lazy.number="frames">
								<span v-if="frames_defined_in_code"
									  title="(defined in code)">
									{{ frames }}
								</span>
							</p>
						</div>
					</div>
				</div>
			</div>
			<div class="foldable foldable-hidden">
				<div class="foldable-header">
					Textures
				</div>
				<div class="foldable-content">
					<div class="settings">
						<p>Add a texture</p>
						<div class="new-texture-input">
							<input type="file" name="texture" class="shadergif-texture-input" accept=".png,.jpg" multiple>
							<button v-on:click="new_texture">Add</button>
						</div>

						<div class="textures">
							<ul class="textures-list">
								<li v-for="(texture, index) in textures">
									{{ index }} -
									<input type="text" v-model="texture.name">
									<span title="sampler2D name">texture{{ index }}<span>
									<button class="delete-texture-button"
											v-on:click="delete_texture(index)">
										Remove
									</button>
								</li>
							</ul>
						</div>
						<p class="has-text-weight-bold">
							Example use:
						</p>
						<pre class="texture-info-pre">// Top of the file:
uniform sampler2D texture0;
// Main:
col += texture2D(texture0,  UV * vec2(1.0, -1.0) + vec2(0.0, 1.0));</pre>
						<br>
						<p class="has-text-weight-bold">WIP</p>
						<p>
							Note: textures are a work in progress.
							Textures are currently not saved to the server.
							The gifs you post will be as you see, but when
							you will open it in the shader player again or in
							the editor, the textures will not exist.
						</p>
					</div>
				</div>
			</div>
			<div class="foldable foldable-hidden">
				<div class="foldable-header">
					gif.js settings
				</div>
				<div class="foldable-content">
					<div class="settings">
						<p>
							Quality:<input type="number" v-model="gifjs.quality">
							<br>
							Dithering:
							<select v-model="gifjs.dithering">
								<option value="false">none</option>
								<option value="FloydSteinberg">FloydSteinberg</option>
								<option value="FalseFloydSteinberg">FalseFloydSteinberg</option>
								<option value="Stucki">Stucki</option>
								<option value="Atkinson">Atkinson</option>
							</select>
						</p>
					</div>
				</div>
			</div>
			<div class="foldable foldable-hidden">
				<div class="foldable-header">
					GPU sound tools
				</div>
				<div class="foldable-content">
					<div class="text-center">
						<button class="inline-block"
								v-if="!sound_mode"
								v-on:click="enable_sound_mode">
							Sound mode
						</button>
						<div v-if="sound_mode">
							<button name="play-sound" class="inline-block"
									v-on:click="play_sound">
								Play sound
							</button>
							<button name="stop-sound" class="inline-block"
									v-on:click="stop_sound">
								Stop
							</button>
							<br><br>
							<button class="inline-block"
										   v-on:click="load_default_sound_shader">
								Load default sound shader
							</button>
							<button class="inline-block"
										   v-on:click="disable_sound_mode">
								Disable sound mode
							</button>
						</div>
					</div>
				</div>
			</div>				
			<hr>
			
			<div class="text-center">
				<h3>Gifs results</h3>
			</div>
			
			<div class="result-images">
				<div v-for="image in images"
					 class="container is-fluid">
					<div class="result-image">					
						<p v-if="image.size" class="text-center">Size:{{ image.size }} kb</p>
						<img v-bind:src="image.src">
						<template v-if="image.type == 'gif'">
							<% if user_signed_in? %>
								<p class="has-text-weight-bold">Submit to front page</p>
								<p>Please include licensing information in
									the code if needed.</p>
								
								<%= form_tag("/gifs/new", method: "post") do %>
									<input type="hidden"
										   name="image"
										   v-bind:value="image.blob">
									<input type="hidden"
										   name="code"
										   v-bind:value="image.code">
									<% if @is_draft %>
										<input type="hidden"
											   name="draft_id"
											   value="<%= @draft.id %>">
									<% end %>
									<div class="field">
										<label class="label">Title</label>
										<div class="control">
											<input type="text" name="title">
										</div>
									</div>
									<div class="field">
										<label class="label">Description</label>
										<div class="control">
											<textarea name="description" class="textarea"
											></textarea>
										</div>
									</div>
									
									<div class="has-text-right">
										<%= submit_tag "Publish", :class => "button is-primary" %>
									</div>
								<% end %>
							<% else %>
								<div class="text-center">
									Create an account or login to submit gifs
								</div>
							<% end %>
						</template>
					</div>
				</div>
			</div>
			
			<br>
			
			<div class="text-left">
				<p>
					<b>Linux/ImageMagick tips</b>
					<br>
					To make a gif from the png images in the .zip archive in Linux:
				</p>
				<pre>convert image-*.png anim.gif</pre>
				<p>
					For stacked png, on Linux, you can split the result like this:
					<pre>convert image.png -crop {{width}}x{{height}} +repage image-%04d.png</pre>
				</p>
				<p>
					And then make gifs:
				</p>
				<pre>convert image-*.png anim.gif</pre>
			</div>
		</div>
	</div>
	<div class="column limit-width-desktop">
		<div class="vertical-scroll">
			<textarea name='fragment' v-model="code">
			</textarea>
		</div>
	</div>
</div>
<script name="draft-code" type="text/plain"
><% if @is_draft %>
 <%= raw(@draft.code.to_json) %>
<% end %></script>
<%= javascript_include_tag 'shader_editor' %>
<%= render :partial => 'default_shader_scripts' %>
